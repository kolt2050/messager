# Messenger

–ß–∞—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, —Å–æ–∑–¥–∞–Ω–Ω–æ–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ FastAPI –±—ç–∫–µ–Ω–¥–∞.

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —á–∞—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø–æ–∑–≤–æ–ª—è—é—â–µ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ–±—â–∞—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏. –û–Ω–æ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –æ—Ç–∑—ã–≤—á–∏–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ (–ö–ª–∏–µ–Ω—Ç)
- **–§—Ä–µ–π–º–≤–æ—Ä–∫**: [React](https://react.dev/)
- **–°–±–æ—Ä—â–∏–∫**: [Vite](https://vitejs.dev/)
- **–°—Ç–∏–ª–∏–∑–∞—Ü–∏—è**: CSS Modules / Standard CSS
- **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è**: React Router
- **HTTP –ö–ª–∏–µ–Ω—Ç**: Axios

### –ë—ç–∫–µ–Ω–¥ (–°–µ—Ä–≤–µ—Ä)
- **–§—Ä–µ–π–º–≤–æ—Ä–∫**: [FastAPI](https://fastapi.tiangolo.com/)
- **ORM –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö**: [SQLAlchemy](https://www.sqlalchemy.org/)
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: JWT (JSON Web Tokens) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `python-jose` –∏ `passlib`
- **–°–≤—è–∑—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**: WebSockets

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å–ª–µ–¥—É—é—â–µ–µ:
- **Node.js** (–≤–µ—Ä—Å–∏—è 18 –∏–ª–∏ –≤—ã—à–µ)
- **Python** (–≤–µ—Ä—Å–∏—è 3.10 –∏–ª–∏ –≤—ã—à–µ)
- **Docker** –∏ **Docker Compose** (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã:

```mermaid
graph TD
    subgraph Client_Side ["–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —Å—Ç–æ—Ä–æ–Ω–∞"]
        Browser[–ë—Ä–∞—É–∑–µ—Ä / Windows App]
        ClientContainer["–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ö–ª–∏–µ–Ω—Ç–∞"]
        ClientCode["React –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Vite)"]
    end

    subgraph Server_Side ["–°–µ—Ä–≤–µ—Ä–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ (Docker)"]
        ServerContainer["–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –°–µ—Ä–≤–µ—Ä–∞"]
        Backend["FastAPI –ë—ç–∫–µ–Ω–¥"]
        DBContainer["–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ë–î"]
        Postgres["PostgreSQL –ë–î"]
    end

    User((–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)) -->|–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç| Browser
    Browser -->|localhost:3001| ClientContainer
    ClientContainer -->|–†–∞–∑–¥–∞–µ—Ç| ClientCode
    
    ClientCode -->|API / WebSockets (8000)| Backend
    Backend -->|SQLAlchemy| Postgres
    
    ServerContainer -.->|–ú–æ–Ω—Ç–∏—Ä—É–µ—Ç| ServerVol["Server Data Volume"]
    DBContainer -.->|–ú–æ–Ω—Ç–∏—Ä—É–µ—Ç| DBVol["Postgres Data Volume"]
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ó–∞–ø—É—Å–∫

–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ª–∏–±–æ —Å –ø–æ–º–æ—â—å—é Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è), –ª–∏–±–æ –≤—Ä—É—á–Ω—É—é.

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**:
   ```bash
   git clone <url-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è>
   cd messager
   ```

2. **–ó–∞–ø—É—Å–∫ –ë—ç–∫–µ–Ω–¥–∞ –∏ –ë–î**:
   ```bash
   docker-compose -f docker-compose.server.yml up -d --build
   ```

3. **–ó–∞–ø—É—Å–∫ –§—Ä–æ–Ω—Ç–µ–Ω–¥–∞**:
   ```bash
   docker-compose -f docker-compose.client.yml up -d --build
   ```

4. **–î–æ—Å—Ç—É–ø**:
   - –§—Ä–æ–Ω—Ç–µ–Ω–¥: `http://localhost:3001`
   - API Docs: `http://localhost:8000/docs`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (CI/CD)

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ **GitHub Actions**. –ü—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É `main` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç workflow:
1. –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø—É—à –≤ GitHub Container Registry (GHCR).
2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ SSH.
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `docker-compose.prod.yml`.

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets
–î–ª—è —Ä–∞–±–æ—Ç—ã –¥–µ–ø–ª–æ—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
- `SERVER_HOST`: IP –∏–ª–∏ –¥–æ–º–µ–Ω –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.
- `SERVER_USER`: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è SSH.
- `SSH_PRIVATE_KEY`: –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á.
- `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`: –î–∞–Ω–Ω—ã–µ –¥–ª—è –±–∞–∑—ã.
- `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS`: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ—á—Ç—ã.

### –í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–∞—è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

<details>
<summary>–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏</summary>

#### –ë—ç–∫–µ–Ω–¥
```bash
cd server
python -m venv venv
source venv/bin/activate # –ù–∞ Windows: venv\Scripts\activate
pip install -r requirements.txt
uvicorn main:app --reload
```

#### –§—Ä–æ–Ω—Ç–µ–Ω–¥
```bash
cd client
npm install
npm run dev
```
</details>

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

```
messager/
‚îú‚îÄ‚îÄ client/                 # React –§—Ä–æ–Ω—Ç–µ–Ω–¥ (Vite)
‚îÇ   ‚îú‚îÄ‚îÄ src/                # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Ö—É–∫–∏, —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/     # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (MediaAttachments –∏ –¥—Ä.)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/          # mediaParsers.js –∏ –¥—Ä.
‚îÇ   ‚îî‚îÄ‚îÄ windows_app.bat     # –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Windows-–≤–µ—Ä—Å–∏–∏
‚îú‚îÄ‚îÄ server/                 # FastAPI –ë—ç–∫–µ–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ routers/            # –ú–∞—Ä—à—Ä—É—Ç—ã API (auth, chat, admin, files, utils)
‚îÇ   ‚îú‚îÄ‚îÄ models.py           # –ú–æ–¥–µ–ª–∏ SQLAlchemy
‚îÇ   ‚îî‚îÄ‚îÄ main.py             # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ .github/workflows/      # GitHub Actions (deploy.yml)
‚îú‚îÄ‚îÄ docker-compose.*.yml    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker (client, server, prod)
‚îî‚îÄ‚îÄ README.md               # –î–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üóÑÔ∏è –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **PostgreSQL 15**. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DATABASE_URL` –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ `docker-compose.server.yml` –∏–ª–∏ `.env`.

### üìß –ü–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä (SMTP)

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SMTP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π:
- **–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è**: –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
- **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ Email**: –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–æ—á—Ç–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
–í —Ñ–∞–π–ª–µ `.env` –∏–ª–∏ —á–µ—Ä–µ–∑ —Å–µ–∫—Ä–µ—Ç—ã GitHub —É–∫–∞–∂–∏—Ç–µ:
- `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS`.

### üåê –ü—Ä–æ–∫—Å–∏ (Proxy)

–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å—Å—ã–ª–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Instagram/TikTok) –±—ç–∫–µ–Ω–¥ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `HTTP_PROXY=http://user:pass@ip:port`
- `HTTPS_PROXY=http://user:pass@ip:port`

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –≤–Ω–µ—à–Ω–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π —Å–µ—Ä–≤–µ—Ä PostgreSQL (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –æ–±–ª–∞–∫–µ –∏–ª–∏ –Ω–∞ —Ö–æ—Å—Ç–µ), –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `docker-compose.server.yml`:

1. –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å—Ç—Ä–æ–∫—É `DATABASE_URL`.
2. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É —Å –ø—Ä–∏–º–µ—Ä–æ–º –≤–Ω–µ—à–Ω–µ–π –±–∞–∑—ã –∏ —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ:
   ```yaml
   environment:
     # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –±–∞–∑–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
     # - DATABASE_URL=postgresql://user:password@db:5432/messager
     
     # –í–Ω–µ—à–Ω—è—è –±–∞–∑–∞
     - DATABASE_URL=postgresql://user:password@external-db-host:5432/messager
   ```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**–°–±—Ä–æ—Å–∏—Ç—å –±–∞–∑—É (—É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ):**
```bash
docker-compose -f docker-compose.server.yml down -v
docker-compose up -d --build server
```

**–ë—ç–∫–∞–ø –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã `pg_dump` –∏ `psql` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º `messager_db`.

## –õ–∏—Ü–µ–Ω–∑–∏—è

[MIT](LICENSE)